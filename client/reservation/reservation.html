<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width='device-width', initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../css/reset.css">
    <link rel="stylesheet" type="text/css" href="../css/header.css">
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>

<style>
    .main_container {
        width: 80%;
        max-width: 1000px;
        margin: 100px auto;
    }

    #cabinet {
        margin: 0 auto;
        display: flex;
        justify-content: center;
        height: 45vw;
        max-height: 500px;
        min-height: 300px;

        display: flex;
        flex-direction: column;
        width: 90%;
        justify-content: space-between;
    }

    .cabinet_select {
        display: flex;
        justify-content: space-between;
        height: 30%;
        border: 1px solid #ddd;
    }

    .cabinet_box {
        width: 23%;
        box-shadow: 0px 0px 10px 0px #aaa;
        margin: 2.5px;
        background-color:white;
    }

    .cabinet_box:hover {
        box-shadow: 0px 0px 10px 0px rgb(147, 107, 221);
    }

    .sub_title {
        font-size: 25px;
        margin: 2em;
        text-align: center;
    }

    @media (max-width: 800px) {
        .sub_title {
            font-size: 20px;
        }
    }
    

    .enable {
        background: gray;
    }

    .enable:hover {
        background: black;
    }

    .disable {
        background: red;
    }


</style>


<body>
    <header>
        <div class="container">
            <div class="menu menu_left">
                <img src="../src/images/logo.jpg" class="logo">
                <span class="title">사물함 예약 시스템</span>
            </div>
            <nav class="menu">
                <ul>
                    <li><a href="#">ABOUT</a></li>
                    <li><a href="#">RESERVATION</a></li>
                </ul>
            </nav>
            <div class="menu menu_right">
                <div class="my_page">마이페이지</div>
            </div>
        </div>
    </header>
    <main>
        <div>
            <div class="main_container">
                <div class="sub_title">사물함 1</div>
                <div class="map" id="cabinet">
                    
                </div>
            </div>
        </div>
    </main>
</body>

<!-- 소켓 생성 -->
<script>
    // 소켓 이벤트를 수행합니다.
    var socket = io.connect();

    // 이벤트를 연결합니다.
    socket.on('reserve', function (data) {
        var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
        $target.removeClass('enable');
        $target.addClass('disable');
    });
</script>

<!-- 초기 좌석 생성 -->
<script>
    $(document).ready(function () {
        // 변수를 선언합니다.
        var onClickSeat = function () {
            var x = $(this).attr('data-x');
            var y = $(this).attr('data-y');
            if (confirm('좌석을 예약하시겠습니까?')) {
                $(this).off('click');
                socket.emit('reserve', {
                    x: x,
                    y: y
                });
            } else {
                alert('취소되었습니다.');
            }
        };

        // Ajax를 수행합니다.
        $.getJSON('/seats', { dummy: new Date().getTime() }, function (data) {
            // 좌석을 생성합니다.
            $.each(data, function (indexY, cabinet_select) {
                // 문서 객체를 생성합니다.
                var $cabinet_select = $('<div></div>').addClass('cabinet_select');
                $.each(cabinet_select, function (indexX, box) {
                    // 문서 객체를 생성하고 변수 $line에 추가합니다.
                    var $output = $('<div></div>', {
                        'class': 'box',
                        'data-x': indexX,
                        'data-y': indexY
                    }).appendTo($cabinet_select);
                    if (seat == 1) {
                        // 좌석이 비어 있으면 enable 클래스와 click 리스너를 추가합니다.
                        $output.addClass('enable').on('click', onClickSeat);
                    } else if (seat == 2) {
                        // 좌석이 사용 불가능하면 disable 클래스를 추가합니다.
                        $output.addClass('disable');
                    }
                });
                // 문서 객체를 추가합니다.
                $line.appendTo('body');
            });
        });
    });
</script>

<script>
    function cabinetMaking(){
        let cabinet = document.getElementById('cabinet');

        const ROW = 10;
        const COL = 10;

        for (let index = 0; index < ROW; index++) {
            let cabinet_select = document.createElement("div");
            cabinet_select.className = "cabinet_select";
            
            for (let index = 0; index < COL; index++) {
                let cabinet_box = document.createElement("div");
                cabinet_box.className = "cabinet_box";
                //코드 정말 별로다! 고쳐야 되는데..;;
                cabinet_box.addEventListener("click",(e)=>{
                    let box = e.target;
                    let box_background = box.style.backgroundColor;

                    
                    if(box_background === "rgb(147, 107, 221)"){
                        box.style.backgroundColor = "white";
                        alert("예약 취소");
                    }else if(box_background ==="black"){
                        alert("이미 예약된 사물함입니다!");
                    }else{
                        box.style.backgroundColor = "rgb(147, 107, 221)";
                        alert("예약 완료");
                    }
                    
                })
                cabinet_select.appendChild(cabinet_box);
            }
            
            cabinet.appendChild(cabinet_select);
        }
        
    }
    cabinetMaking();

    
    

</script>
</html>